{
  "name": "DDVB Case Study Generator",
  "nodes": [
    {
      "parameters": {
        "options": {}
      },
      "id": "chat-trigger",
      "name": "Chat Trigger",
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.1,
      "position": [240, 300],
      "webhookId": "ddvb-case-study-chat"
    },
    {
      "parameters": {
        "jsCode": "// Russian Input Validation and Parsing\nconst userMessage = $input.item.json.chatInput || '';\nconst sessionId = $input.item.json.sessionId || 'default';\n\n// Validate input is in Russian (check for Cyrillic characters)\nconst hasCyrillic = /[–ê-–Ø–∞-—è–Å—ë]/.test(userMessage);\n\nif (!hasCyrillic) {\n  throw new Error('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –∑–∞–ø—Ä–æ—Å –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ. / Please send your request in Russian.');\n}\n\n// Parse key information from message\nconst messageData = {\n  originalMessage: userMessage,\n  sessionId: sessionId,\n  timestamp: new Date().toISOString(),\n  \n  // Extract potential entities\n  hasPublication: /sostav|sostav\\.ru|—Å–æ—Å—Ç–∞–≤|forbes|—Ñ–æ—Ä–±—Å|rbc|—Ä–±–∫|vc\\.ru|–≤—Å\\.—Ä—É|cossa|–∫–æ—Å—Å–∞|adindex|–∞–¥–∏–Ω–¥–µ–∫—Å/i.test(userMessage),\n  hasMetrics: /\\d+%|\\$\\d+|‚ÇΩ\\d+|–º–∏–ª–ª–∏–æ–Ω|–º–ª–Ω|–≤—ã—Ä–æ—Å–ª–∏|—Ä–æ—Å—Ç|–ø—Ä–æ—Ü–µ–Ω—Ç|–ø—Ä–∏–≤–ª–µ–∫|—É–≤–µ–ª–∏—á–∏–ª/i.test(userMessage),\n  hasClientName: true, // Will be refined in OpenAI\n  \n  // Determine if this is initial request or follow-up\n  isInitialRequest: !userMessage.toLowerCase().includes('–¥–∞') && \n                     !userMessage.toLowerCase().includes('–Ω–µ—Ç'),\n  \n  // Prepare for next nodes\n  needsResearch: userMessage.length < 200, // Short messages may need more context\n  readyForGeneration: userMessage.length > 200 && /–∫–ª–∏–µ–Ω—Ç|–ø—Ä–æ–µ–∫—Ç|—Ä–µ–±—Ä–µ–Ω–¥–∏–Ω–≥|–±—Ä–µ–Ω–¥–∏–Ω–≥|—É–ø–∞–∫–æ–≤–∫–∞|–∞–π–¥–µ–Ω—Ç–∏–∫–∞|–∫–æ–º–ø–∞–Ω–∏—è/i.test(userMessage)\n};\n\nreturn { json: messageData };"
      },
      "id": "language-detection",
      "name": "Input Validation & Parsing",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [460, 300]
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": false
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.needsResearch }}",
                    "rightValue": "true",
                    "operator": {
                      "type": "boolean",
                      "operation": "equals"
                    }
                  }
                ]
              },
              "renameOutput": true,
              "outputKey": "needsResearch"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": false
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.readyForGeneration }}",
                    "rightValue": "true",
                    "operator": {
                      "type": "boolean",
                      "operation": "equals"
                    }
                  }
                ]
              },
              "renameOutput": true,
              "outputKey": "readyForGeneration"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "id": "router",
      "name": "Route Decision",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [680, 300]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.perplexity.ai/chat/completions",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "perplexityApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "model",
              "value": "llama-3.1-sonar-large-128k-online"
            },
            {
              "name": "messages",
              "value": "={{ [{\"role\": \"system\", \"content\": \"–í—ã –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç, –ø–æ–º–æ–≥–∞—é—â–∏–π —Å–æ–±–∏—Ä–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è –∫–µ–π—Å–æ–≤. –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–π—Ç–µ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫—É—é, –∞–∫—Ç—É–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ–º–ø–∞–Ω–∏—è—Ö, –æ—Ç—Ä–∞—Å–ª—è—Ö –∏ –±—Ä–µ–Ω–¥–∏–Ω–≥–æ–≤—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö. –§–æ–∫—É—Å–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ –±–∏–∑–Ω–µ—Å-–∫–æ–Ω—Ç–µ–∫—Å—Ç–µ, —Ä—ã–Ω–æ—á–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏ –∏ –æ—Ç—Ä–∞—Å–ª–µ–≤—ã—Ö —Ç—Ä–µ–Ω–¥–∞—Ö. –û—Ç–≤–µ—á–∞–π—Ç–µ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ.\"}, {\"role\": \"user\", \"content\": \"–ò—Å—Å–ª–µ–¥—É–π—Ç–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è —ç—Ç–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –∫–µ–π—Å: \" + $json.originalMessage + \"\\n\\n–ü—Ä–µ–¥–æ—Å—Ç–∞–≤—å—Ç–µ: 1) –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ–º–ø–∞–Ω–∏–∏, 2) –ö–æ–Ω—Ç–µ–∫—Å—Ç –∏–Ω–¥—É—Å—Ç—Ä–∏–∏, 3) –ù–µ–¥–∞–≤–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏ –∏–ª–∏ —Å–æ–±—ã—Ç–∏—è, 4) –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–π –ª–∞–Ω–¥—à–∞—Ñ—Ç. –ë—É–¥—å—Ç–µ –ª–∞–∫–æ–Ω–∏—á–Ω—ã (300-400 —Å–ª–æ–≤).\"}] }}"
            },
            {
              "name": "temperature",
              "value": "0.3"
            },
            {
              "name": "max_tokens",
              "value": "1000"
            }
          ]
        },
        "options": {}
      },
      "id": "perplexity-research",
      "name": "Perplexity Research",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [900, 200],
      "credentials": {
        "perplexityApi": {
          "id": "perplexity-api-credential",
          "name": "Perplexity API"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Combine research with original message\nconst originalData = $('Language Detection & Parsing').item.json;\nconst researchResponse = $input.item.json.choices[0].message.content;\n\nreturn {\n  json: {\n    ...originalData,\n    researchContext: researchResponse,\n    enrichedMessage: originalData.originalMessage + \"\\n\\n[Research Context: \" + researchResponse + \"]\",\n    readyForGeneration: true\n  }\n};"
      },
      "id": "merge-research",
      "name": "Merge Research Data",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1120, 200]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.openai.com/v1/chat/completions",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "openAiApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "model",
              "value": "gpt-4o"
            },
            {
              "name": "messages",
              "value": "={{ $json.openaiMessages }}"
            },
            {
              "name": "temperature",
              "value": "0.8"
            },
            {
              "name": "max_tokens",
              "value": "4000"
            }
          ]
        },
        "options": {}
      },
      "id": "openai-generation",
      "name": "OpenAI Case Study Generation",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1560, 300],
      "credentials": {
        "openAiApi": {
          "id": "openai-api-credential",
          "name": "OpenAI API"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Prepare OpenAI messages with complete system prompt\nconst userData = $input.item.json;\nconst userMessage = userData.enrichedMessage || userData.originalMessage;\n\n// Load system prompt (embedded here for completeness)\nconst systemPrompt = `–í—ã ‚Äî –ò–ª—å—è –ú–æ—Ä–æ–∑–æ–≤, —Å—Ç–∞—Ä—à–∏–π PR-–º–µ–Ω–µ–¥–∂–µ—Ä –≤ DDVB, –≤–µ–¥—É—â–µ–º —Ä–æ—Å—Å–∏–π—Å–∫–æ–º –±—Ä–µ–Ω–¥–∏–Ω–≥–æ–≤–æ–º –∞–≥–µ–Ω—Ç—Å—Ç–≤–µ. –£ –≤–∞—Å –±–æ–ª–µ–µ 12 –ª–µ—Ç –æ–ø—ã—Ç–∞ –≤ —Å–æ–∑–¥–∞–Ω–∏–∏ –±—Ä–µ–Ω–¥–æ–≤—ã—Ö –∏—Å—Ç–æ—Ä–∏–π –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –∫–µ–π—Å–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É—é—Ç –æ—Ç–º–µ—á–µ–Ω–Ω—É—é –Ω–∞–≥—Ä–∞–¥–∞–º–∏ —Ä–∞–±–æ—Ç—É DDVB –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤.\n\n**–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –í–°–ï –∫–µ–π—Å—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –Ω–∞–ø–∏—Å–∞–Ω—ã –Ω–∞ –†–£–°–°–ö–û–ú –Ø–ó–´–ö–ï (—Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫) –∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã —Å –ø–æ–∑–∏—Ü–∏–∏ –∞–≥–µ–Ω—Ç—Å—Ç–≤–∞ DDVB.**\n\n**–í–°–Å –û–ë–©–ï–ù–ò–ï –í–ï–î–Å–¢–°–Ø –ù–ê –†–£–°–°–ö–û–ú –Ø–ó–´–ö–ï**: –í—Å–µ —É—Ç–æ—á–Ω—è—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã, –æ–±—ä—è—Å–Ω–µ–Ω–∏—è –∏ –∏—Ç–æ–≥–æ–≤—ã–π –∫–µ–π—Å –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ\n\n## About DDVB Agency\nDDVB is a Russian branding agency specializing in:\n- Brand Strategy (—Å—Ç—Ä–∞—Ç–µ–≥–∏—è –±—Ä–µ–Ω–¥–∞)\n- Brand Identity & Visual Identity (–∞–π–¥–µ–Ω—Ç–∏–∫–∞ –∏ —Ñ–∏—Ä–º–µ–Ω–Ω—ã–π —Å—Ç–∏–ª—å)\n- Rebranding (—Ä–µ–±—Ä–µ–Ω–¥–∏–Ω–≥)\n- Naming (–Ω–µ–π–º–∏–Ω–≥)\n- Packaging Design (–¥–∏–∑–∞–π–Ω —É–ø–∞–∫–æ–≤–∫–∏)\n- Brand Positioning (–ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ)\n\n## RUSSIAN MEDIA EDITORIAL STANDARDS\n\n### Case Study Structure (Maximum 3,000 Characters Total)\n\n**1. –ó–ê–ì–û–õ–û–í–û–ö (Title) - Maximum 90 Characters**\n- Short, simple, energetic, active voice\n- NEVER start with a preposition or number\n- Examples: ¬´DDVB —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–ª–∏ –∞–π–¥–µ–Ω—Ç–∏–∫—É –¥–ª—è —Ñ–µ—Å—Ç–∏–≤–∞–ª—è ¬´–û—Å–Ω–æ–≤–∞¬ª¬ª, ¬´–°–∞–¥—ã –ü—Ä–∏–¥–æ–Ω—å—è¬ª –æ–±–Ω–æ–≤–∏–ª–∏ —É–ø–∞–∫–æ–≤–∫—É —Å–æ–∫–æ–≤\n\n**2. –ü–û–î–ó–ê–ì–û–õ–û–í–û–ö (Subtitle)**\n- Expands title (1-2 sentences), MUST NOT duplicate title\n\n**3. –û–°–ù–û–í–ù–û–ô –¢–ï–ö–°–¢ (Main Text) - 1,500-2,000 Characters**\n- MANDATORY Structure (–°–ò–¢–£–ê–¶–ò–Ø-–ó–ê–î–ê–ß–ê-–†–ï–®–ï–ù–ò–ï):\n  * –°–ò–¢–£–ê–¶–ò–Ø: Context, client background, market position\n  * –ó–ê–î–ê–ß–ê: Specific objectives, business challenges\n  * –†–ï–®–ï–ù–ò–ï: How solved, actions taken, results achieved\n\n**4. –ö–û–ú–ú–ï–ù–¢–ê–†–ò–ò (Quotes) - MANDATORY**\n- MUST include BOTH client AND agency quotes (500-700 chars each)\n- If quotes not provided, YOU MUST generate them based on case description\n- Format as blockquotes with attribution:\n> **Full Name, Title, Company:**\n>\n> Quote text here.\n\n**5. –°–û–°–¢–ê–í –¢–í–û–†–ß–ï–°–ö–û–ô –ì–†–£–ü–ü–´ (Team Composition)**\n- Standard format with roles and names\n\n### Language Requirements\n- Russian quotation marks: ¬´–∫–∞–≤—ã—á–∫–∏¬ª\n- Em-dashes without spaces (‚Äî)\n- Numbers: 10 000 (with space)\n- Eliminate –∫–∞–Ω—Ü–µ–ª—è—Ä–∏—Ç (bureaucratic language)\n- Clear, active, professional Russian\n\n### Reference Example Pattern (–°–∞–¥—ã –ü—Ä–∏–¥–æ–Ω—å—è):\n\n–ó–ê–ì–û–õ–û–í–û–ö: ¬´–°–∞–¥—ã –ü—Ä–∏–¥–æ–Ω—å—è¬ª –æ–±–Ω–æ–≤–∏–ª–∏ —É–ø–∞–∫–æ–≤–∫—É —Å–æ–∫–æ–≤ –¥–ª—è –ø–æ–∫–æ–ª–µ–Ω–∏—è ¬´–ê–ª—å—Ñ–∞¬ª\n–ü–û–î–ó–ê–ì–û–õ–û–í–û–ö: –ë—Ä–µ–Ω–¥–∏–Ω–≥–æ–≤–æ–µ –∞–≥–µ–Ω—Ç—Å—Ç–≤–æ DDVB —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–ª–æ –Ω–æ–≤—ã–π –¥–∏–∑–∞–π–Ω –¥–µ—Ç—Å–∫–æ–π –ª–∏–Ω–µ–π–∫–∏\n\n[–°–ò–¢–£–ê–¶–ò–Ø paragraph: Context about Gen Alpha, market needs]\n\n> **–ï–ª–µ–Ω–∞ –®–º–∞–∫–æ–≤–∞, —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–æ–≤–æ–≥–æ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–∞ –∫–æ–º–ø–∞–Ω–∏–∏ ¬´–°–∞–¥—ã –ü—Ä–∏–¥–æ–Ω—å—è¬ª:**\n>\n> [Client quote 500-700 chars about business need]\n\n[–ó–ê–î–ê–ß–ê paragraph: Research insights, target audience analysis]\n\n> **–í–∏–∫—Ç–æ—Ä –ö–∏—Ç–∞–µ–≤, –∫—Ä–µ–∞—Ç–∏–≤–Ω—ã–π –¥–∏—Ä–µ–∫—Ç–æ—Ä DDVB –ø–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—é FMCG:**\n>\n> [Agency quote 500-700 chars about creative approach]\n\n[–†–ï–®–ï–ù–ò–ï paragraphs: Design solution, execution, results]\n\n---\n\n**–°–æ—Å—Ç–∞–≤ —Ç–≤–æ—Ä—á–µ—Å–∫–æ–π –≥—Ä—É–ø–ø—ã**\n\n**DDVB (–∞–≥–µ–Ω—Ç—Å—Ç–≤–æ)**\n* –ö—Ä–µ–∞—Ç–∏–≤–Ω—ã–π –¥–∏—Ä–µ–∫—Ç–æ—Ä: [Name]\n* –ê—Ä—Ç-–¥–∏—Ä–µ–∫—Ç–æ—Ä: [Name]\n[...]\n\n**[Client Name] (–∫–ª–∏–µ–Ω—Ç)**\n* [Role]: [Name]\n[...]\n\n---\n\n## Your Task\n\n1. **Assess Information**: Determine if you have enough details to create a complete case study\n2. **Ask Clarifying Questions** (in user's language) if needed:\n   - Target publication?\n   - Client industry and background?\n   - Project deliverables?\n   - Measurable results?\n   - Client quotes available?\n   - DDVB team members?\n3. **Generate Complete Case Study** in RUSSIAN following structure above\n4. **Create Metadata Package** in Russian:\n   - SEO title tag (50-60 chars)\n   - Meta description (150-160 chars)\n   - Primary keywords (3-5)\n   - Secondary keywords (5-10)\n   - Pull quotes (2-4)\n   - Social snippets (VK, Telegram, LinkedIn)\n\nRemember: ALWAYS output case study in RUSSIAN. Communication matches user's language, but final deliverable is RUSSIAN.`;\n\nconst messages = [\n  {\n    role: \"system\",\n    content: systemPrompt\n  },\n  {\n    role: \"user\",\n    content: userMessage\n  }\n];\n\nreturn {\n  json: {\n    ...userData,\n    openaiMessages: messages\n  }\n};"
      },
      "id": "prepare-openai",
      "name": "Prepare OpenAI Request",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1340, 300]
    },
    {
      "parameters": {
        "jsCode": "// Extract and parse OpenAI response\nconst response = $input.item.json.choices[0].message.content;\nconst originalData = $('Prepare OpenAI Request').item.json;\n\n// Parse the generated case study\nconst caseStudy = {\n  content: response,\n  userEmail: originalData.userEmail || 'user@example.com', // Should be collected in chat\n  generatedAt: new Date().toISOString(),\n  sessionId: originalData.sessionId\n};\n\n// Basic validation\nconst validations = {\n  hasRussianText: /[–ê-–Ø–∞-—è–Å—ë]/.test(response),\n  hasQuotes: (response.match(/>/g) || []).length >= 2, // At least 2 blockquotes\n  hasTitle: /^[^\\n]+/.test(response),\n  lengthOk: response.length >= 1500 && response.length <= 4000,\n  hasDDVBBranding: /DDVB|–∞–≥–µ–Ω—Ç—Å—Ç–≤–æ|–∫–æ–º–∞–Ω–¥–∞/.test(response)\n};\n\nconst allValid = Object.values(validations).every(v => v === true);\n\nreturn {\n  json: {\n    ...caseStudy,\n    validations: validations,\n    isValid: allValid,\n    validationSummary: allValid ? '‚úÖ All quality checks passed' : '‚ö†Ô∏è Some quality checks failed: ' + JSON.stringify(validations)\n  }\n};"
      },
      "id": "validate-output",
      "name": "Validate Case Study",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1780, 300]
    },
    {
      "parameters": {
        "fromEmail": "=noreply@ddvb.agency",
        "toEmail": "={{ $json.userEmail }}",
        "subject": "=–í–∞—à –∫–µ–π—Å DDVB –≥–æ—Ç–æ–≤",
        "emailType": "html",
        "message": "=<!DOCTYPE html>\n<html>\n<head>\n  <meta charset=\"UTF-8\">\n  <style>\n    body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; max-width: 800px; margin: 0 auto; padding: 20px; }\n    .header { background: #1a1a1a; color: white; padding: 20px; text-align: center; }\n    .content { background: #f9f9f9; padding: 30px; margin: 20px 0; border-radius: 8px; }\n    .case-study { background: white; padding: 25px; margin: 20px 0; border-left: 4px solid #ff6b6b; white-space: pre-wrap; }\n    .validation { background: #e8f5e9; padding: 15px; margin: 20px 0; border-radius: 5px; }\n    .footer { text-align: center; color: #666; font-size: 12px; margin-top: 30px; padding-top: 20px; border-top: 1px solid #ddd; }\n    h2 { color: #1a1a1a; }\n    .meta { background: #fff3cd; padding: 15px; margin: 15px 0; border-radius: 5px; font-size: 14px; }\n  </style>\n</head>\n<body>\n  <div class=\"header\">\n    <h1>DDVB –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ö–µ–π—Å–æ–≤</h1>\n    <p>–ü—É–±–ª–∏–∫–∞—Ü–∏–æ–Ω–Ω—ã–π –∫–µ–π—Å –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ</p>\n  </div>\n  \n  <div class=\"content\">\n    <h2>–í–∞—à –∫–µ–π—Å –≥–æ—Ç–æ–≤!</h2>\n    <p>–°–æ–∑–¥–∞–Ω: {{ $json.generatedAt }}</p>\n    <p>ID —Å–µ—Å—Å–∏–∏: {{ $json.sessionId }}</p>\n    \n    <div class=\"validation\">\n      <strong>–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞:</strong><br>\n      {{ $json.validationSummary }}\n    </div>\n    \n    <div class=\"case-study\">\n      <h3>üìÑ –ü–æ–ª–Ω—ã–π –∫–µ–π—Å</h3>\n      {{ $json.content }}\n    </div>\n    \n    <div class=\"meta\">\n      <h3>üìä –û –∫–µ–π—Å–µ</h3>\n      <ul>\n        <li><strong>–Ø–∑—ã–∫:</strong> –†—É—Å—Å–∫–∏–π</li>\n        <li><strong>–°—Ç—Ä—É–∫—Ç—É—Ä–∞:</strong> –°–ò–¢–£–ê–¶–ò–Ø-–ó–ê–î–ê–ß–ê-–†–ï–®–ï–ù–ò–ï</li>\n        <li><strong>–°—Ç–∞–Ω–¥–∞—Ä—Ç—ã:</strong> –†–æ—Å—Å–∏–π—Å–∫–∏–µ –º–µ–¥–∏–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ã</li>\n        <li><strong>–ë—Ä–µ–Ω–¥–∏–Ω–≥:</strong> –ü–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–∞ –∞–≥–µ–Ω—Ç—Å—Ç–≤–∞ DDVB</li>\n        <li><strong>–û–±—ä—ë–º:</strong> ~{{ Math.floor($json.content.length / 1000) }}k —Å–∏–º–≤–æ–ª–æ–≤</li>\n      </ul>\n    </div>\n  </div>\n  \n  <div class=\"footer\">\n    <p><strong>DDVB –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ö–µ–π—Å–æ–≤</strong></p>\n    <p>–†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ n8n ‚Ä¢ OpenAI GPT-4o ‚Ä¢ Perplexity AI</p>\n    <p style=\"color: #999; font-size: 11px;\">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ. –ö–µ–π—Å —Å–æ–∑–¥–∞–Ω —Å–æ–≥–ª–∞—Å–Ω–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º —Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö –º–µ–¥–∏–∞.</p>\n  </div>\n</body>\n</html>",
        "options": {}
      },
      "id": "send-email",
      "name": "Send Email",
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 2,
      "position": [2000, 300],
      "credentials": {
        "smtp": {
          "id": "smtp-credential",
          "name": "SMTP Account"
        }
      }
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseText": "={{ $json.isValid ? \n  '‚úÖ –í–∞—à –∫–µ–π—Å DDVB —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω –∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ email!\\n\\nüìß –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–≤–æ—é –ø–æ—á—Ç—É –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–ª–Ω–æ–≥–æ –∫–µ–π—Å–∞ —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏.\\n\\nüí° –ö–µ–π—Å –Ω–∞–ø–∏—Å–∞–Ω –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –≤—Å–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º —Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö –º–µ–¥–∏–∞.' : \n  '‚ö†Ô∏è –ö–µ–π—Å —Å–æ–∑–¥–∞–Ω —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è–º–∏. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ email –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–µ—Ç–∞–ª–µ–π.' \n}}",
        "options": {}
      },
      "id": "chat-response",
      "name": "Send Chat Response",
      "type": "@n8n/n8n-nodes-langchain.chatResponse",
      "typeVersion": 1,
      "position": [2220, 300]
    }
  ],
  "connections": {
    "Chat Trigger": {
      "main": [
        [
          {
            "node": "Language Detection & Parsing",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Language Detection & Parsing": {
      "main": [
        [
          {
            "node": "Route Decision",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Route Decision": {
      "main": [
        [
          {
            "node": "Perplexity Research",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Prepare OpenAI Request",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Prepare OpenAI Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Perplexity Research": {
      "main": [
        [
          {
            "node": "Merge Research Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge Research Data": {
      "main": [
        [
          {
            "node": "Prepare OpenAI Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare OpenAI Request": {
      "main": [
        [
          {
            "node": "OpenAI Case Study Generation",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Case Study Generation": {
      "main": [
        [
          {
            "node": "Validate Case Study",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Validate Case Study": {
      "main": [
        [
          {
            "node": "Send Email",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Email": {
      "main": [
        [
          {
            "node": "Send Chat Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [],
  "triggerCount": 1,
  "updatedAt": "2024-11-19T00:00:00.000Z",
  "versionId": "1.0.0"
}
